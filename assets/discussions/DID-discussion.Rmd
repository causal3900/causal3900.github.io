---
title: "DiscussionDID"
author: "Mayleen and Daniel"
date: "2023-10-30"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```

## Empirical Application: How the Abolition of Elected Councils Affects Local Public Services in Vietnam

Include some background on the experiment and a link to the paper

### Download the data
```{r}
library(dplyr)
library(tidyverse)
load(file = "malesky2014.rda")
malesky2014 <- drop_na(malesky2014, lnarea, lnpopden, city)
```


### About the data

- explain the columns we use: treatment, pro4, tapwater, agrext, year, post_treat (any others?)

```{r}
head(malesky2014)
```


### Visualizing Trends in the Treatment and Control Groups

In a DID design, the first step is to visualize the trends of the treatment and control groups to check if the parallel trends assumption is credible. Here, we look at three possible outcomes: "Education and Cultural Program," "Tap Water," and "Agricultural Center."

```{r}
malesky2014 %>%
  mutate(treatment = ifelse(treatment == 1, "Treated in 2009","Untreated")) %>%
  group_by(treatment, year) %>%
  summarize(estimate = mean(pro4)) %>%
  ggplot(aes(x = year, y = estimate, color = treatment)) + geom_point() + geom_line() + ggtitle("Education and Cultural Program")
```


```{r}
malesky2014 %>%
  mutate(treatment = ifelse(treatment == 1, "Treated in 2009","Untreated")) %>%
  group_by(treatment, year) %>%
  summarize(estimate = mean(tapwater)) %>%
  ggplot(aes(x = year, y = estimate, color = treatment)) + geom_point() + geom_line() + ggtitle("Tap Water")
```

```{r}
malesky2014 %>%
  mutate(treatment = ifelse(treatment == 1, "Treated in 2009","Untreated")) %>%
  group_by(treatment, year) %>%
  summarize(estimate = mean(agrext)) %>%
  ggplot(aes(x = year, y = estimate, color = treatment)) + geom_point() + geom_line() + ggtitle("Agricultural Center")
```
Notice how we see parallel trends in the pretreatment period for the outcome "Education and Cultural Program," but not for "Tap Water" or "Agricultural Center."

### Basic Difference in Differences Analysis with One Pretreatment Period

```{r}
# remove the extra pretreatment periods from the dataset
onePerMalesky <- malesky2014 %>%
  filter(year==2008 | year ==2010)

# the column treatment I think captures whether you're in treatment vs control group
# the column post_treat I think captures the time--whether you're in pre-treatment or post-treatment period

# did is an interaction term between post_treat and treat
onePerMalesky <- onePerMalesky %>%
  mutate(did = post_treat*treatment)

# regression for Education and Cultural Program on treatment, time period, and interaction term
didReg <- lm(pro4 ~ treatment + post_treat + did, data = onePerMalesky)

summary(didReg)

# estimate
print(didReg$coefficients["did"])
```

### More Advanced DID Design??


