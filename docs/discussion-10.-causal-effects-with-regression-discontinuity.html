<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Discussion 10. Causal Effects with Regression Discontinuity | Causal Inference Course</title>
<meta name="author" content="Ian Lundberg and Sam Wang">
<meta name="description" content="Slides Download today’s .Rmd document here.  13.1 Choosing a bandwidth One of the main difficulties of a regression discontinuity analysis is choosing a ``good’’ bandwidth. This is a good example...">
<meta name="generator" content="bookdown 0.35 with bs4_book()">
<meta property="og:title" content="Discussion 10. Causal Effects with Regression Discontinuity | Causal Inference Course">
<meta property="og:type" content="book">
<meta property="og:description" content="Slides Download today’s .Rmd document here.  13.1 Choosing a bandwidth One of the main difficulties of a regression discontinuity analysis is choosing a ``good’’ bandwidth. This is a good example...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Discussion 10. Causal Effects with Regression Discontinuity | Causal Inference Course">
<meta name="twitter:description" content="Slides Download today’s .Rmd document here.  13.1 Choosing a bandwidth One of the main difficulties of a regression discontinuity analysis is choosing a ``good’’ bandwidth. This is a good example...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.5.1/transition.js"></script><script src="libs/bs3compat-0.5.1/tabs.js"></script><script src="libs/bs3compat-0.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style.css">
<link rel="stylesheet" type="text/css" href="https://tikzjax.com/v1/fonts.css">
<script src="https://tikzjax.com/v1/tikzjax.js"></script>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Causal Inference Course</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li><a class="" href="defining-counterfactuals.html"><span class="header-section-number">1</span> Defining counterfactuals</a></li>
<li class="book-part">Identification by exchangeability</li>
<li><a class="" href="exchangeability-and-experiments.html"><span class="header-section-number">2</span> Exchangeability and experiments</a></li>
<li><a class="" href="consistency-and-positivity.html"><span class="header-section-number">3</span> Consistency and positivity</a></li>
<li><a class="" href="directed-acyclic-graphs.html"><span class="header-section-number">4</span> Directed Acyclic Graphs</a></li>
<li><a class="" href="statistical-modeling.html"><span class="header-section-number">5</span> Statistical modeling</a></li>
<li class="book-part">Identification without exchangeability</li>
<li><a class="" href="front-door.html"><span class="header-section-number">6</span> Front door</a></li>
<li><a class="" href="instrumental-variables.html"><span class="header-section-number">7</span> Instrumental variables</a></li>
<li><a class="" href="regression-discontinuity.html"><span class="header-section-number">8</span> Regression discontinuity</a></li>
<li><a class="" href="difference-in-difference.html"><span class="header-section-number">9</span> Difference in difference</a></li>
<li><a class="" href="synthetic-control.html"><span class="header-section-number">10</span> Synthetic control</a></li>
<li class="book-part">Areas of active research</li>
<li><a class="" href="data-driven-methods.html"><span class="header-section-number">11</span> Data-driven methods</a></li>
<li><a class="" href="current-research.html"><span class="header-section-number">12</span> Current research</a></li>
<li><a class="" href="course-recap.html"><span class="header-section-number">13</span> Course recap</a></li>
<li><a class="active" href="discussion-10.-causal-effects-with-regression-discontinuity.html">Discussion 10. Causal Effects with Regression Discontinuity</a></li>
<li class="book-part">Discussions</li>
<li><a class="" href="discussion-2.-stats-review.html">Discussion 2. Stats review</a></li>
<li><a class="" href="discussion-3.-analyzing-an-experiment-in-r.html">Discussion 3. Analyzing an Experiment in R</a></li>
<li><a class="" href="discussion-3.-analyzing-an-experiment-in-r-solutions.html">Discussion 3. Analyzing an Experiment in R SOLUTIONS</a></li>
<li><a class="" href="discussion-7.-causal-effects-with-matching.html">Discussion 7. Causal Effects with Matching</a></li>
<li class="book-part">Assignments</li>
<li><a class="" href="due-dates.html">Due dates</a></li>
<li><a class="" href="final-project.html">Final Project</a></li>
<li><a class="" href="problem-set-1.-definitions.html">Problem Set 1. Definitions</a></li>
<li><a class="" href="problem-set-2.-experiments.html">Problem Set 2. Experiments</a></li>
<li><a class="" href="problem-set-3.-dags..html">Problem Set 3. DAGs.</a></li>
<li><a class="" href="problem-set-4.-statistical-modeling.html">Problem Set 4. Statistical modeling</a></li>
<li><a class="" href="problem-set-5.-iv-rd.html">Problem Set 5. IV + RD</a></li>
<li><a class="" href="problem-set-6.-did-synthetic-control.html">Problem Set 6. DID + synthetic control</a></li>
<li class="book-part">Course information</li>
<li><a class="" href="who-we-are.html">Who we are</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="discussion-10.-causal-effects-with-regression-discontinuity" class="section level1 unnumbered">
<h1>Discussion 10. Causal Effects with Regression Discontinuity<a class="anchor" aria-label="anchor" href="#discussion-10.-causal-effects-with-regression-discontinuity"><i class="fas fa-link"></i></a>
</h1>
<p><a href="assets/discussions/discussion10.pdf"><strong>Slides</strong></a>
Download today’s <a href="assets/discussions/discussion10.Rmd"><strong>.Rmd document here</strong></a>.</p>
<div id="choosing-a-bandwidth" class="section level2" number="13.1">
<h2>
<span class="header-section-number">13.1</span> Choosing a bandwidth<a class="anchor" aria-label="anchor" href="#choosing-a-bandwidth"><i class="fas fa-link"></i></a>
</h2>
<p>One of the main difficulties of a regression discontinuity analysis is choosing a ``good’’ bandwidth. This is a good example of the bias variance trade-off which appears all the time in statistics. In general, we will let the software choose this for us, but it will be helpful to run through a small example to better understand the subtleties involved.</p>
<p>Suppose <span class="math inline">\(Y\)</span> is a very non-linear function of <span class="math inline">\(X\)</span>, and we want to extrapolate and predict <span class="math inline">\(Y\)</span> at <span class="math inline">\(X=0\)</span>.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">n</span>, <span class="op">-</span><span class="fl">5</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">### Y is a very non-linear function of X + some noise</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fl">5</span> <span class="op">-</span> <span class="fl">3</span><span class="op">*</span><span class="va">X</span> <span class="op">+</span> <span class="fl">.6</span> <span class="op">*</span> <span class="va">X</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="fl">.3</span> <span class="op">*</span> <span class="va">X</span><span class="op">^</span><span class="fl">3</span> <span class="op">+</span> <span class="fl">15</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, sd <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">Y</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">15</span>, <span class="fl">30</span><span class="op">)</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="st">"gray"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co">### Avg Y when X = 0 is 5</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, pch <span class="op">=</span> <span class="fl">18</span>, col <span class="op">=</span> <span class="st">"orange"</span>, cex <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="discussion10_files/figure-html/unnamed-chunk-1-1.png" width="672"></div>
<p>If we blindly fit a line to all our observations, the predicted value for <span class="math inline">\(X=0\)</span> is off by quite a bit.
<img src="discussion10_files/figure-html/unnamed-chunk-2-1.png" width="672"></p>
<p>If we instead restrict ourselves to a smaller region around 0, we can do a bit better</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Only consider points h away from 0</span></span>
<span><span class="va">h</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span></span>
<span><span class="va">fit.mod.bandwidth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Y</span><span class="op">~</span><span class="va">X</span>, subset <span class="op">=</span> <span class="va">X</span> <span class="op">&gt;</span> <span class="op">-</span><span class="va">h</span><span class="op">)</span></span>
<span><span class="va">plotColor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">&gt;</span> <span class="va">h</span>, <span class="st">"gray"</span>, <span class="st">"red"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">Y</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">15</span>, <span class="fl">30</span><span class="op">)</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">plotColor</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="st">"gray"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span><span class="op">-</span><span class="va">h</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit.mod.bandwidth</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>X <span class="op">=</span> <span class="op">-</span><span class="va">h</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit.mod.bandwidth</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,col <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>         lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, pch <span class="op">=</span> <span class="fl">18</span>, col <span class="op">=</span> <span class="st">"orange"</span>, cex <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure">
<img src="discussion10_files/figure-html/unnamed-chunk-3-1.png" width="672">
However, if we get more and more data, we don’t really improve much</div>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">10000</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">n</span>, <span class="op">-</span><span class="fl">5</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fl">5</span> <span class="op">-</span> <span class="fl">3</span><span class="op">*</span><span class="va">X</span> <span class="op">+</span> <span class="fl">.6</span> <span class="op">*</span> <span class="va">X</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="fl">.3</span> <span class="op">*</span> <span class="va">X</span><span class="op">^</span><span class="fl">3</span> <span class="op">+</span> <span class="fl">15</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, sd <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">h</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">fit.mod.bandwidth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Y</span><span class="op">~</span><span class="va">X</span>, subset <span class="op">=</span> <span class="va">X</span> <span class="op">&gt;</span> <span class="op">-</span><span class="va">h</span><span class="op">)</span></span>
<span><span class="va">plotColor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">&gt;</span> <span class="va">h</span>, <span class="st">"gray"</span>, <span class="st">"red"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">Y</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">15</span>, <span class="fl">30</span><span class="op">)</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">plotColor</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="st">"gray"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span><span class="op">-</span><span class="va">h</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit.mod.bandwidth</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>X <span class="op">=</span> <span class="op">-</span><span class="va">h</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit.mod.bandwidth</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,col <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>         lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, pch <span class="op">=</span> <span class="fl">18</span>, col <span class="op">=</span> <span class="st">"orange"</span>, cex <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="discussion10_files/figure-html/unnamed-chunk-4-1.png" width="672"></div>
<p>Ideally, we would decrease the bandwidth to reduce this bias, but this also means we are working with less data. Since each data point is noisy, if we were to get a new sample, the estimate could change quite a bit. Try running this a few times and see how much the estimate moves. Compare this which how much the estimate moves if the bandwidth is 2.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">h</span> <span class="op">&lt;-</span> <span class="fl">.3</span> <span class="co"># bandwidth</span></span>
<span><span class="co"># h &lt;- 2 </span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">n</span>, <span class="op">-</span><span class="fl">5</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fl">5</span> <span class="op">-</span> <span class="fl">3</span><span class="op">*</span><span class="va">X</span> <span class="op">+</span> <span class="fl">.6</span> <span class="op">*</span> <span class="va">X</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="fl">.3</span> <span class="op">*</span> <span class="va">X</span><span class="op">^</span><span class="fl">3</span> <span class="op">+</span> <span class="fl">15</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, sd <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit.mod.bandwidth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Y</span><span class="op">~</span><span class="va">X</span>, subset <span class="op">=</span> <span class="va">X</span> <span class="op">&gt;</span> <span class="op">-</span><span class="va">h</span><span class="op">)</span></span>
<span><span class="va">plotColor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">&gt;</span> <span class="va">h</span>, <span class="st">"gray"</span>, <span class="st">"red"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">Y</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">15</span>, <span class="fl">30</span><span class="op">)</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">plotColor</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="st">"gray"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span><span class="op">-</span><span class="va">h</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit.mod.bandwidth</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>X <span class="op">=</span> <span class="op">-</span><span class="va">h</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit.mod.bandwidth</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,col <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>         lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, pch <span class="op">=</span> <span class="fl">18</span>, col <span class="op">=</span> <span class="st">"orange"</span>, cex <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit.mod.bandwidth</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"blue"</span>, pch <span class="op">=</span> <span class="fl">19</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="discussion10_files/figure-html/unnamed-chunk-5-1.png" width="672"></div>
<p>Knowing the best bandwidth is a hard problem, but generally speaking a good choice of bandwidth will get smaller as the sample size increases.</p>
<p>If we measure accuracy in terms of average squared error, we can see when <span class="math inline">\(n = 100\)</span>, a bandwidth of 1.2 seems to be best. However, test and see if how that changes for larger values of <span class="math inline">\(n\)</span></p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">h</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.5</span>, <span class="fl">.8</span>, <span class="fl">1.2</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">sim.size</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="va">rec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">sim.size</span>, <span class="fl">8</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">sim.size</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">n</span>, <span class="op">-</span><span class="fl">5</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="va">Y</span> <span class="op">&lt;-</span> <span class="fl">5</span> <span class="op">-</span> <span class="fl">3</span><span class="op">*</span><span class="va">X</span> <span class="op">+</span> <span class="fl">.6</span> <span class="op">*</span> <span class="va">X</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="fl">.3</span> <span class="op">*</span> <span class="va">X</span><span class="op">^</span><span class="fl">3</span> <span class="op">+</span> <span class="fl">15</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, sd <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">fit.mod.bandwidth1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Y</span><span class="op">~</span><span class="va">X</span>, subset <span class="op">=</span> <span class="va">X</span> <span class="op">&gt;</span> <span class="op">-</span><span class="va">h</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">fit.mod.bandwidth2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Y</span><span class="op">~</span><span class="va">X</span>, subset <span class="op">=</span> <span class="va">X</span> <span class="op">&gt;</span> <span class="op">-</span><span class="va">h</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">fit.mod.bandwidth3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Y</span><span class="op">~</span><span class="va">X</span>, subset <span class="op">=</span> <span class="va">X</span> <span class="op">&gt;</span> <span class="op">-</span><span class="va">h</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">fit.mod.bandwidth4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Y</span><span class="op">~</span><span class="va">X</span>, subset <span class="op">=</span> <span class="va">X</span> <span class="op">&gt;</span> <span class="op">-</span><span class="va">h</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">rec</span><span class="op">[</span><span class="va">i</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit.mod.bandwidth1</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">5</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span>
<span>  <span class="va">rec</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit.mod.bandwidth2</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">5</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span>
<span>  <span class="va">rec</span><span class="op">[</span><span class="va">i</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit.mod.bandwidth3</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">5</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span>
<span>  <span class="va">rec</span><span class="op">[</span><span class="va">i</span>, <span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit.mod.bandwidth4</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">5</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span>
<span>  </span>
<span>  <span class="va">rec</span><span class="op">[</span><span class="va">i</span>, <span class="fl">5</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit.mod.bandwidth1</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">rec</span><span class="op">[</span><span class="va">i</span>, <span class="fl">6</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit.mod.bandwidth2</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">rec</span><span class="op">[</span><span class="va">i</span>, <span class="fl">7</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit.mod.bandwidth3</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">rec</span><span class="op">[</span><span class="va">i</span>, <span class="fl">8</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit.mod.bandwidth4</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span><span class="op">(</span><span class="va">rec</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 15.801843  5.110703  3.952649 12.877716  4.955253
## [6]  4.791482  4.194144  1.730246</code></pre>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html">boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">rec</span><span class="op">[</span>, <span class="fl">5</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">5</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure">
<img src="discussion10_files/figure-html/unnamed-chunk-6-1.png" width="672">
### Weighted Least Squares</div>
<p>When we estimate a linear regression model, we usually pick linear coefficients to minimize the squared errors
<span class="math display">\[\min_b \sum_i(Y_i - X_i b)^2\]</span>
and the squared error for each observation count are considered equally. But if a good fit around some points is more important than other points, we can also use weighted least squares where <span class="math inline">\(w_i\)</span> is a weight.
<span class="math display">\[\min_b \sum_i w_i(Y_i - X_i b)^2\]</span>
When <span class="math inline">\(w_i\)</span> is larger, the squared error for observation <span class="math inline">\(i\)</span> will cost more so the selected linear coefficient will prioritize minimizing errors where <span class="math inline">\(w_i\)</span> is large. In our particular setting, we want to prioritize fitting the data well around <span class="math inline">\(0\)</span>, so we can use weights which are ``triangular’’ which prioritize points near <span class="math inline">\(0\)</span>.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">200</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">n</span>, <span class="op">-</span><span class="fl">5</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fl">5</span> <span class="op">-</span> <span class="fl">3</span><span class="op">*</span><span class="va">X</span> <span class="op">+</span> <span class="fl">.6</span> <span class="op">*</span> <span class="va">X</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="fl">.3</span> <span class="op">*</span> <span class="va">X</span><span class="op">^</span><span class="fl">3</span> <span class="op">+</span> <span class="fl">15</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, sd <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">weight</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">/</span> <span class="fl">5</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">weight</span>, type <span class="op">=</span> <span class="st">"p"</span>, main <span class="op">=</span> <span class="st">"Triangular Weights"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="discussion10_files/figure-html/unnamed-chunk-7-1.png" width="672"></div>
<div id="question" class="section level4" number="13.1.0.1">
<h4>
<span class="header-section-number">13.1.0.1</span> Question<a class="anchor" aria-label="anchor" href="#question"><i class="fas fa-link"></i></a>
</h4>
<p>If we use a bandwidth of <span class="math inline">\(h\)</span> (i.e., only include observations within <span class="math inline">\(h\)</span> of the cut-off), what does this mean the the weights would be?</p>
<p>When using triangular weights, we can see that this does better than using all the points.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">200</span></span>
<span><span class="va">h</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">n</span>, <span class="op">-</span><span class="fl">5</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fl">5</span> <span class="op">-</span> <span class="fl">3</span><span class="op">*</span><span class="va">X</span> <span class="op">+</span> <span class="fl">.6</span> <span class="op">*</span> <span class="va">X</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="fl">.3</span> <span class="op">*</span> <span class="va">X</span><span class="op">^</span><span class="fl">3</span> <span class="op">+</span> <span class="fl">15</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, sd <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="va">weight</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">/</span> <span class="fl">5</span> </span>
<span><span class="co"># We don't include a bandwidth, but instead use triangular weights</span></span>
<span><span class="va">fit.mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Y</span><span class="op">~</span><span class="va">X</span><span class="op">)</span></span>
<span><span class="va">fit.mod.weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Y</span><span class="op">~</span><span class="va">X</span>, weights <span class="op">=</span> <span class="va">weight</span><span class="op">)</span></span>
<span><span class="va">fit.mod.bandwidth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Y</span><span class="op">~</span><span class="va">X</span>, subset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">h</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plotColor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">&gt;</span> <span class="va">h</span>, <span class="st">"gray"</span>, <span class="st">"red"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">Y</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">15</span>, <span class="fl">30</span><span class="op">)</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">plotColor</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="st">"gray"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span><span class="op">-</span><span class="va">h</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit.mod.bandwidth</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>X <span class="op">=</span> <span class="op">-</span><span class="va">h</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit.mod.bandwidth</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,col <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>         lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit from weighted least squares</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit.mod.weights</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>X <span class="op">=</span> <span class="op">-</span><span class="va">h</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit.mod.weights</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,col <span class="op">=</span> <span class="st">"green"</span>,</span>
<span>         lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit from ordinary least squares</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit.mod</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>X <span class="op">=</span> <span class="op">-</span><span class="va">h</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit.mod</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,col <span class="op">=</span> <span class="st">"purple"</span>,</span>
<span>         lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, pch <span class="op">=</span> <span class="fl">18</span>, col <span class="op">=</span> <span class="st">"orange"</span>, cex <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit.mod.bandwidth</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"blue"</span>, pch <span class="op">=</span> <span class="fl">19</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit.mod.weights</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"green"</span>, pch <span class="op">=</span> <span class="fl">19</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit.mod</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"purple"</span>, pch <span class="op">=</span> <span class="fl">19</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure">
<img src="discussion10_files/figure-html/unnamed-chunk-8-1.png" width="672">
In practice, we can combine both a hard thresholding bandwidth as well as triangular weights (within the bandwidth)</div>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># bandwidth</span></span>
<span><span class="va">h</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">200</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">n</span>, <span class="op">-</span><span class="fl">5</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fl">5</span> <span class="op">-</span> <span class="fl">3</span><span class="op">*</span><span class="va">X</span> <span class="op">+</span> <span class="fl">.6</span> <span class="op">*</span> <span class="va">X</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="fl">.3</span> <span class="op">*</span> <span class="va">X</span><span class="op">^</span><span class="fl">3</span> <span class="op">+</span> <span class="fl">15</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, sd <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># weight is triangular within the bandwidth</span></span>
<span><span class="va">weight</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">h</span>, <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">/</span> <span class="va">h</span>, <span class="fl">0</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">weight</span>, type <span class="op">=</span> <span class="st">"p"</span>, main <span class="op">=</span> <span class="st">"Triangular Weights"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="discussion10_files/figure-html/unnamed-chunk-9-1.png" width="672"></div>
</div>
</div>
<div id="rdd-analysis" class="section level2" number="13.2">
<h2>
<span class="header-section-number">13.2</span> RDD Analysis<a class="anchor" aria-label="anchor" href="#rdd-analysis"><i class="fas fa-link"></i></a>
</h2>
<p>Now let’s apply a regression discontinuity analysis to data. This example follows the analysis ``Randomization Inference in the Regression Discontinuity Design: An Application to Party Advantages in the U.S. Senate’’ by Cattaneo, Frandsen, and Titiunik (2015) and their replication file.</p>
<p>Political scientists are interested in the effect of being an incumbent (the currently elected politician) on the share of votes in an election. Being the current public official means increased name recognition, fundraising opportunities, etc. On the other hand, being an incumbent means you can get blamed for all the bad things that have happened during your term.</p>
<p>The data we analyze considers US senators. Each state in the US has two senators with 6 year terms, and the election for each of the two senators alternates every 3 years. So for instance, there are two senate seats: A and B. In 2000 senate seat A undergoes an election, in 2003 senate seat B undergoes an election but senate seat A continues, in 2006 senate seat A undergoes an election but senate seat B continues on, etc.</p>
<p>We will look at the causal effect on being an incumbent in senate races in two different ways.First, does being an incumbent effect your vote share the next time you run for office? Second, if the other sitting senator is from your same party, what is the effect on your election share?</p>
<div id="question-1" class="section level4" number="13.2.0.1">
<h4>
<span class="header-section-number">13.2.0.1</span> Question<a class="anchor" aria-label="anchor" href="#question-1"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Consider the first question and draw out a causal diagram where the treatment is being an incumbent and the outcome of interest is vote share in an election.</li>
<li>How might we use regression discontinuity to provide an answer to this question?</li>
</ul>
</div>
<div id="data" class="section level3" number="13.2.1">
<h3>
<span class="header-section-number">13.2.1</span> Data<a class="anchor" aria-label="anchor" href="#data"><i class="fas fa-link"></i></a>
</h3>
<p>We’ll examine data from US Senate races from 1914 to 2010 to try and answer these questions.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">install</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">package</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va">package</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span>, character.only <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="va">package</span>, repos <span class="op">=</span> <span class="st">"http://cran.us.r-project.org"</span>, type <span class="op">=</span> <span class="st">"binary"</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">package</span>, character.only <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">install</span><span class="op">(</span><span class="st">"ggplot2"</span><span class="op">)</span></span>
<span><span class="fu">install</span><span class="op">(</span><span class="st">"lpdensity"</span><span class="op">)</span></span>
<span><span class="fu">install</span><span class="op">(</span><span class="st">"rddensity"</span><span class="op">)</span></span>
<span><span class="fu">install</span><span class="op">(</span><span class="st">"rdrobust"</span><span class="op">)</span></span>
<span><span class="fu">install</span><span class="op">(</span><span class="st">"rdlocrand"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/rdpackages-replication/CIT_2020_CUP/master/CIT_2020_CUP_senate.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
<pre><code>##         state year dopen population presdemvoteshlag1
## 1 Connecticut 1914     0    1233000          39.15937
## 2 Connecticut 1916     0    1294000          39.15937
## 3 Connecticut 1922     0    1431000          33.02737
## 4 Connecticut 1926     0    1531000          27.52570
## 5 Connecticut 1928     1    1577000          27.52570
## 6 Connecticut 1932     0    1637000          45.57480
##         demmv demvoteshlag1 demvoteshlag2 demvoteshfor1
## 1  -7.6885610            NA            NA      46.23941
## 2  -3.9237082      42.07694            NA      36.09757
## 3  -6.8686604      36.09757      46.23941      35.64121
## 4 -27.6680560      45.46875      36.09757      45.59821
## 5  -8.2569685      35.64121      45.46875      48.47606
## 6   0.7324815      45.59821      35.64121      51.74687
##   demvoteshfor2 demwinprv1 demwinprv2 dmidterm dpresdem
## 1      36.09757         NA         NA        1        1
## 2      45.46875          0         NA        0        1
## 3      45.59821          0          0        1        0
## 4      48.47606          0          0        1        0
## 5      51.74687          0          0        0        0
## 6      39.80264          0          0        0        0</code></pre>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># presdemvoteshlag1 is democratic vote share in the previous presidential election</span></span>
<span><span class="co"># demmv is the democratic margin of victory in the current senate election (i.e., democratic percentage - next closest percentage)</span></span>
<span><span class="co">#   so a value just above 0 indicates a very close victory, a value just below 0 indicates a very close loss</span></span>
<span><span class="co"># demovoteshlag1 and 2 indicates the vote share 1 and 2 election cycles ago</span></span>
<span><span class="co"># demovoteshfor1 and 2 indicates the vote share 1 and 2 elections cycles in the future</span></span></code></pre></div>
<p>For the first analysis, we will consider whether being the incumbent effects vote share in the next election. Thus, the outcome of interest is because the next time the same seat goes up for election is 2 cycles in the future.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dem_vote_t2</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">demvoteshfor2</span></span>
<span><span class="va">dem_margin_t0</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">demmv</span></span>
<span></span>
<span><span class="co"># plot the data</span></span>
<span><span class="co"># Set p = 0 for a straight line (i.e., regression with X^p)</span></span>
<span><span class="fu">rdplot</span><span class="op">(</span>y <span class="op">=</span> <span class="va">dem_vote_t2</span>, x <span class="op">=</span>  <span class="va">dem_margin_t0</span>, nbins <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">1000</span><span class="op">)</span>, p <span class="op">=</span> <span class="fl">0</span>, col.lines <span class="op">=</span> <span class="st">"red"</span>, col.dots <span class="op">=</span> <span class="st">"lightgray"</span>, title <span class="op">=</span> <span class="st">"Incumbency Advantage"</span>, y.lim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">100</span><span class="op">)</span>, x.label <span class="op">=</span> <span class="st">"Dem Margin of Victory"</span>, y.label <span class="op">=</span> <span class="st">"Dem Vote Share in next election"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="discussion10_files/figure-html/unnamed-chunk-11-1.png" width="672"></div>
<p>Let’s zoom in a bit to the closer races and use non-linear regression. There appears to still be a slight discontinuity.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rdplot</span><span class="op">(</span><span class="va">dem_vote_t2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">dem_margin_t0</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">25</span><span class="op">]</span>, <span class="va">dem_margin_t0</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">dem_margin_t0</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">25</span><span class="op">]</span>, nbins <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2500</span>, <span class="fl">500</span><span class="op">)</span>, p <span class="op">=</span> <span class="fl">4</span>, col.lines <span class="op">=</span> <span class="st">"red"</span>, col.dots <span class="op">=</span> <span class="st">"lightgray"</span>, title <span class="op">=</span> <span class="st">""</span>,  y.lim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">100</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="discussion10_files/figure-html/unnamed-chunk-12-1.png" width="672"></div>
</div>
<div id="estimating-the-causal-effect" class="section level3" number="13.2.2">
<h3>
<span class="header-section-number">13.2.2</span> Estimating the causal effect<a class="anchor" aria-label="anchor" href="#estimating-the-causal-effect"><i class="fas fa-link"></i></a>
</h3>
<p>As an example, we’ll manually set the bandwidth to 10, and then estimate a linear regression on both sides of the cut-off. The estimated intercept is the prediction at <span class="math inline">\(0\)</span>, so to get the estimate, we just take the difference.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set bandwidth to 10</span></span>
<span><span class="va">h</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="co"># Fit regression to left and right of cut-off</span></span>
<span><span class="va">lm_left</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">dem_vote_t2</span> <span class="op">~</span> <span class="va">dem_margin_t0</span>, subset <span class="op">=</span> <span class="va">dem_margin_t0</span> <span class="op">&lt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">dem_margin_t0</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="va">h</span><span class="op">)</span></span>
<span><span class="va">lm_right</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">dem_vote_t2</span> <span class="op">~</span> <span class="va">dem_margin_t0</span>, subset <span class="op">=</span> <span class="va">dem_margin_t0</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">dem_margin_t0</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="va">h</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Estimate is difference in interecepts</span></span>
<span><span class="va">lm_right</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">lm_left</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> </span></code></pre></div>
<pre><code>## (Intercept) 
##    6.898794</code></pre>
<p>We can try the same with the triangular weights.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">h</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">weight</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">dem_margin_t0</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">h</span>, <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">dem_margin_t0</span><span class="op">)</span> <span class="op">/</span> <span class="va">h</span>, <span class="fl">0</span><span class="op">)</span> </span>
<span></span>
<span><span class="co">## Note we don't need subs</span></span>
<span><span class="va">lm_left</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">dem_vote_t2</span> <span class="op">~</span> <span class="va">dem_margin_t0</span>, subset <span class="op">=</span> <span class="va">dem_margin_t0</span> <span class="op">&lt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">dem_margin_t0</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="va">h</span>, weights <span class="op">=</span> <span class="va">weight</span><span class="op">)</span></span>
<span><span class="va">lm_right</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">dem_vote_t2</span> <span class="op">~</span> <span class="va">dem_margin_t0</span>, subset <span class="op">=</span> <span class="va">dem_margin_t0</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">dem_margin_t0</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="va">h</span>, weights <span class="op">=</span> <span class="va">weight</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Estimate is difference in interecepts</span></span>
<span><span class="va">lm_right</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">lm_left</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> </span></code></pre></div>
<pre><code>## (Intercept) 
##    7.984687</code></pre>
<div id="question-2" class="section level4" number="13.2.2.1">
<h4>
<span class="header-section-number">13.2.2.1</span> Question<a class="anchor" aria-label="anchor" href="#question-2"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Describe in both mathematical notation, and in plain language what causal effect is being estimated.</li>
</ul>
</div>
</div>
</div>
<div id="using-rdrobust" class="section level2" number="13.3">
<h2>
<span class="header-section-number">13.3</span> Using rdrobust<a class="anchor" aria-label="anchor" href="#using-rdrobust"><i class="fas fa-link"></i></a>
</h2>
<p>As you can see, getting the estimates aren’t so difficult once we’ve selected a bandwidth. But selecting a good bandwidth can be tricky and getting standard errors on the estimate are also difficult. We can use the R package to select the bandwidth, estimate the causal effect quantities, and give standard errors.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># uniform kernel with bandwidth 10</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">rdrobust</span><span class="op">(</span><span class="va">dem_vote_t2</span>, <span class="va">dem_margin_t0</span>, kernel <span class="op">=</span> <span class="st">'uniform'</span>,  p <span class="op">=</span> <span class="fl">1</span>, h <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Sharp RD estimates using local polynomial regression.
## 
## Number of Obs.                 1297
## BW type                      Manual
## Kernel                      Uniform
## VCE method                       NN
## 
## Number of Obs.                  595          702
## Eff. Number of Obs.             245          206
## Order est. (p)                    1            1
## Order bias  (q)                   2            2
## BW est. (h)                  10.000       10.000
## BW bias (b)                  10.000       10.000
## rho (h/b)                     1.000        1.000
## Unique Obs.                     595          702
## 
## =============================================================================
##         Method     Coef. Std. Err.         z     P&gt;|z|      [ 95% C.I. ]       
## =============================================================================
##   Conventional     6.899     1.722     4.007     0.000     [3.525 , 10.273]    
##         Robust         -         -     3.891     0.000     [5.156 , 15.624]    
## =============================================================================</code></pre>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># triangular kernel with bandwidth 10</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">rdrobust</span><span class="op">(</span><span class="va">dem_vote_t2</span>, <span class="va">dem_margin_t0</span>,  kernel <span class="op">=</span> <span class="st">'triangular'</span>,  p <span class="op">=</span> <span class="fl">1</span>, h <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Sharp RD estimates using local polynomial regression.
## 
## Number of Obs.                 1297
## BW type                      Manual
## Kernel                   Triangular
## VCE method                       NN
## 
## Number of Obs.                  595          702
## Eff. Number of Obs.             245          206
## Order est. (p)                    1            1
## Order bias  (q)                   2            2
## BW est. (h)                  10.000       10.000
## BW bias (b)                  10.000       10.000
## rho (h/b)                     1.000        1.000
## Unique Obs.                     595          702
## 
## =============================================================================
##         Method     Coef. Std. Err.         z     P&gt;|z|      [ 95% C.I. ]       
## =============================================================================
##   Conventional     7.985     1.838     4.344     0.000     [4.382 , 11.587]    
##         Robust         -         -     4.387     0.000     [6.595 , 17.249]    
## =============================================================================</code></pre>
<p>If we don’t specify a bandwidth directly, the software will choose for us</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># uniform kernel with software selected bandwidth</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">rdrobust</span><span class="op">(</span><span class="va">dem_vote_t2</span>, <span class="va">dem_margin_t0</span>, kernel <span class="op">=</span> <span class="st">'triangular'</span>,  p <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Sharp RD estimates using local polynomial regression.
## 
## Number of Obs.                 1297
## BW type                       mserd
## Kernel                   Triangular
## VCE method                       NN
## 
## Number of Obs.                  595          702
## Eff. Number of Obs.             360          323
## Order est. (p)                    1            1
## Order bias  (q)                   2            2
## BW est. (h)                  17.754       17.754
## BW bias (b)                  28.028       28.028
## rho (h/b)                     0.633        0.633
## Unique Obs.                     595          665
## 
## =============================================================================
##         Method     Coef. Std. Err.         z     P&gt;|z|      [ 95% C.I. ]       
## =============================================================================
##   Conventional     7.414     1.459     5.083     0.000     [4.555 , 10.273]    
##         Robust         -         -     4.311     0.000     [4.094 , 10.919]    
## =============================================================================</code></pre>
<div id="try-on-your-own" class="section level3" number="13.3.1">
<h3>
<span class="header-section-number">13.3.1</span> Try on your own<a class="anchor" aria-label="anchor" href="#try-on-your-own"><i class="fas fa-link"></i></a>
</h3>
<p>Now try on your own and estimate the causal effect of the senator who is not up for election being a democrat on the democratic vote share of the senator who is up for election. In this case, the outcome of interest is demvoteshfor1 since we are interested in the immediately following election.</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dem_vote_t1</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">demvoteshfor1</span></span>
<span><span class="va">dem_margin_t0</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">demmv</span></span>
<span></span>
<span><span class="co"># plot the data</span></span>
<span><span class="co"># Set p = 0 for a straight line (i.e., regression with X^p)</span></span>
<span><span class="fu">rdplot</span><span class="op">(</span>y <span class="op">=</span> <span class="va">dem_vote_t1</span>, x <span class="op">=</span>  <span class="va">dem_margin_t0</span>, nbins <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">1000</span><span class="op">)</span>, p <span class="op">=</span> <span class="fl">0</span>, col.lines <span class="op">=</span> <span class="st">"red"</span>, col.dots <span class="op">=</span> <span class="st">"lightgray"</span>, title <span class="op">=</span> <span class="st">"Incumbency Advantage"</span>, y.lim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">100</span><span class="op">)</span>, x.label <span class="op">=</span> <span class="st">"Dem Margin of Victory"</span>, y.label <span class="op">=</span> <span class="st">"Dem Vote Share in next election"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="discussion10_files/figure-html/unnamed-chunk-18-1.png" width="672"></div>

</div>
</div>
</div>



  <div class="chapter-nav">
<div class="prev"><a href="course-recap.html"><span class="header-section-number">13</span> Course recap</a></div>
<div class="next"><a href="discussion-2.-stats-review.html">Discussion 2. Stats review</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#discussion-10.-causal-effects-with-regression-discontinuity">Discussion 10. Causal Effects with Regression Discontinuity</a></li>
<li><a class="nav-link" href="#choosing-a-bandwidth"><span class="header-section-number">13.1</span> Choosing a bandwidth</a></li>
<li>
<a class="nav-link" href="#rdd-analysis"><span class="header-section-number">13.2</span> RDD Analysis</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#data"><span class="header-section-number">13.2.1</span> Data</a></li>
<li><a class="nav-link" href="#estimating-the-causal-effect"><span class="header-section-number">13.2.2</span> Estimating the causal effect</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#using-rdrobust"><span class="header-section-number">13.3</span> Using rdrobust</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#try-on-your-own"><span class="header-section-number">13.3.1</span> Try on your own</a></li></ul>
</li>
</ul>
      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="syllabus" href="assets/Syllabus_Causal_Inference_3900.pdf">Syllabus </a></li>
          <li><a id="canvas" href="https://canvas.cornell.edu/courses/57329">Canvas </a></li>
          <li><a id="ed" href="https://edstem.org/us/courses/40928">Ed Discussion </a></li>
          
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>Last built on 2023-10-31</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This site was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
