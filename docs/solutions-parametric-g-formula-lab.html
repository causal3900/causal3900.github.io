<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Solutions: Parametric g-formula Lab | Causal Inference Course</title>
<meta name="author" content="Mayleen Cortez-Rodriguez and Sam Wang">
<meta name="description" content="The goal: estimate the average treatment effect (ATE) \(E(Y^{a=1}) - E(Y^{a=0})\). If I knew both potential outcomes for everyone in the population, I could just take the averages. The fundamental...">
<meta name="generator" content="bookdown 0.40 with bs4_book()">
<meta property="og:title" content="Solutions: Parametric g-formula Lab | Causal Inference Course">
<meta property="og:type" content="book">
<meta property="og:description" content="The goal: estimate the average treatment effect (ATE) \(E(Y^{a=1}) - E(Y^{a=0})\). If I knew both potential outcomes for everyone in the population, I could just take the averages. The fundamental...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Solutions: Parametric g-formula Lab | Causal Inference Course">
<meta name="twitter:description" content="The goal: estimate the average treatment effect (ATE) \(E(Y^{a=1}) - E(Y^{a=0})\). If I knew both potential outcomes for everyone in the population, I could just take the averages. The fundamental...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.8.0/transition.js"></script><script src="libs/bs3compat-0.8.0/tabs.js"></script><script src="libs/bs3compat-0.8.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style.css">
<link rel="stylesheet" type="text/css" href="https://tikzjax.com/v1/fonts.css">
<script src="https://tikzjax.com/v1/tikzjax.js"></script>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Causal Inference Course</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li><a class="" href="defining-counterfactuals.html"><span class="header-section-number">1</span> Defining counterfactuals</a></li>
<li class="book-part">Identification by exchangeability</li>
<li><a class="" href="exchangeability-and-experiments.html"><span class="header-section-number">2</span> Exchangeability and experiments</a></li>
<li><a class="" href="consistency-and-positivity.html"><span class="header-section-number">3</span> Consistency and positivity</a></li>
<li><a class="" href="directed-acyclic-graphs.html"><span class="header-section-number">4</span> Directed Acyclic Graphs</a></li>
<li><a class="" href="statistical-modeling.html"><span class="header-section-number">5</span> Statistical modeling</a></li>
<li class="book-part">Identification without exchangeability</li>
<li><a class="" href="instrumental-variables.html"><span class="header-section-number">6</span> Instrumental variables</a></li>
<li><a class="" href="regression-discontinuity.html"><span class="header-section-number">7</span> Regression discontinuity</a></li>
<li><a class="" href="difference-in-difference.html"><span class="header-section-number">8</span> Difference in difference</a></li>
<li><a class="" href="synthetic-control.html"><span class="header-section-number">9</span> Synthetic control</a></li>
<li class="book-part">Areas of active research</li>
<li><a class="" href="data-driven-methods.html"><span class="header-section-number">10</span> Data-driven methods</a></li>
<li><a class="" href="current-research.html"><span class="header-section-number">11</span> Current research</a></li>
<li><a class="" href="course-recap.html"><span class="header-section-number">12</span> Course recap</a></li>
<li class="book-part">Discussions</li>
<li><a class="" href="discussion-2.-stats-review.html">Discussion 2. Stats review</a></li>
<li><a class="" href="discussion-3.-analyzing-an-experiment-in-r.html">Discussion 3. Analyzing an Experiment in R</a></li>
<li><a class="" href="discussion-05.-course-project-task-1.html">Discussion 05. Course Project: Task 1</a></li>
<li><a class="" href="solutions-matching-lab.html">Solutions: Matching Lab</a></li>
<li><a class="active" href="solutions-parametric-g-formula-lab.html">Solutions: Parametric g-formula Lab</a></li>
<li class="book-part">Assignments</li>
<li><a class="" href="due-dates.html">Due dates</a></li>
<li><a class="" href="course-project.html">Course Project</a></li>
<li><a class="" href="problem-set-1.-definitions.html">Problem Set 1. Definitions</a></li>
<li><a class="" href="problem-set-2.-experiments.html">Problem Set 2. Experiments</a></li>
<li><a class="" href="problem-set-3.-dags..html">Problem Set 3. DAGs.</a></li>
<li><a class="" href="problem-set-4.-statistical-modeling.html">Problem Set 4. Statistical Modeling</a></li>
<li><a class="" href="problem-set-5.-iv-rd.html">Problem Set 5. IV + RD</a></li>
<li><a class="" href="problem-set-6.-difference-in-difference-synthetic-control.html">Problem Set 6. Difference in Difference + Synthetic Control</a></li>
<li class="book-part">Course information</li>
<li><a class="" href="who-we-are.html">Who we are</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="solutions-parametric-g-formula-lab" class="section level1 unnumbered">
<h1>Solutions: Parametric g-formula Lab<a class="anchor" aria-label="anchor" href="#solutions-parametric-g-formula-lab"><i class="fas fa-link"></i></a>
</h1>
<ul>
<li>The goal: estimate the average treatment effect (ATE) <span class="math inline">\(E(Y^{a=1}) - E(Y^{a=0})\)</span>.</li>
<li>If I knew both potential outcomes for everyone in the population, I could just take the averages.</li>
<li>The fundamental problem of causal inference: I can only observe one potential outcome for each person.</li>
<li>A potential solution: create a model for the outcome
<ul>
<li>For a person who is treated, I know their outcome under treatment. I use a model to predict what their outcome would be if they had not been treated.</li>
</ul>
</li>
<li>I can predict the <em>other</em> potential outcome for everyone in my dataset using a model!</li>
</ul>
<div id="download-the-data" class="section level2 unnumbered">
<h2>Download the Data<a class="anchor" aria-label="anchor" href="#download-the-data"><i class="fas fa-link"></i></a>
</h2>
<p>Follow the steps on Ed Discussion to download the data!</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span></code></pre></div>
<pre><code>## ── Attaching core tidyverse packages ──── tidyverse 2.0.0 ──
## ✔ dplyr     1.1.4     ✔ readr     2.1.5
## ✔ forcats   1.0.0     ✔ stringr   1.5.1
## ✔ ggplot2   3.5.1     ✔ tibble    3.2.1
## ✔ lubridate 1.9.3     ✔ tidyr     1.3.1
## ✔ purrr     1.0.2     
## ── Conflicts ────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()
## ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"assets/discussions/d.RDS"</span><span class="op">)</span></span></code></pre></div>
<p>After you download the data and save it into the variable name <code>d</code>, go up top to where it says <code>knitr::opts_chunk$set(echo = TRUE, eval=F)</code> at the top of the R Markdown file and change <code>eval</code> to true, i.e. set <code>eval=T</code> so that when you knit the file, your code runs.</p>
</div>
<div id="step-0-learn-a-model-to-predict-y-given-avecl" class="section level2 unnumbered">
<h2>Step 0: Learn a model to predict <span class="math inline">\(Y\)</span> given <span class="math inline">\(\{A,\vec{L}\}\)</span><a class="anchor" aria-label="anchor" href="#step-0-learn-a-model-to-predict-y-given-avecl"><i class="fas fa-link"></i></a>
</h2>
<p>You can learn more about the <code>lm</code> function <a href="https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/lm"><strong>here</strong></a>.
Note that this function takes several arguments. The first argument is a formula, specifically a symbolic description of the model to be fitted.</p>
<p>First, we create the formula <code>f</code> which represents the outcome <code>y</code> as a function of our treatment <code>a</code> and all our confounders. Then, using the <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> function, we fit a model with linear regression.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="va">y</span> <span class="op">~</span> <span class="va">a</span><span class="op">*</span><span class="op">(</span><span class="va">sex</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">mom_educ</span> <span class="op">+</span> <span class="va">dad_educ</span> <span class="op">+</span> <span class="va">log_parent_income</span> <span class="op">+</span> <span class="va">log_parent_wealth</span> <span class="op">+</span> <span class="va">test_percentile</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Estimate the model with OLS</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">f</span>, data <span class="op">=</span> <span class="va">d</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="step-1-create-two-copies-of-the-original-data" class="section level2 unnumbered">
<h2>Step 1: Create Two Copies of the Original Data<a class="anchor" aria-label="anchor" href="#step-1-create-two-copies-of-the-original-data"><i class="fas fa-link"></i></a>
</h2>
<p>Next, we are going to create two copies of our original data. The first copy will set all the treatment values <code>= "no_college"</code> and the second copy will set all the treatment values <code>= "college"</code>.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d_all_control</span> <span class="op">&lt;-</span> <span class="va">d</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>a <span class="op">=</span> <span class="st">"no_college"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">d_all_treated</span> <span class="op">&lt;-</span> <span class="va">d</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>a <span class="op">=</span> <span class="st">"college"</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="step-2-predict-both-potential-outcomes-for-everyone" class="section level2 unnumbered">
<h2>Step 2: Predict both potential outcomes for everyone<a class="anchor" aria-label="anchor" href="#step-2-predict-both-potential-outcomes-for-everyone"><i class="fas fa-link"></i></a>
</h2>
<p>Next we will use our model (estimated above) to predict both potential outcomes for each individual using the two data.frames that we just created. We will then append the estimated potential outcomes to our original data.</p>
<p>To see more details on the <code>predict</code> function, see the
<a href="https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/predict">documentation here</a>.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Estimate potential outcomes using our model</span></span>
<span><span class="va">potential_outcomes_under_control</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">fit</span>, newdata <span class="op">=</span> <span class="va">d_all_control</span><span class="op">)</span></span>
<span><span class="va">potential_outcomes_under_treatment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">fit</span>, newdata <span class="op">=</span> <span class="va">d_all_treated</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># append the estimated potential outcomes to our original data.</span></span>
<span><span class="va">conditional_average_outcomes</span> <span class="op">&lt;-</span> <span class="va">d</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>yhat0 <span class="op">=</span> <span class="va">potential_outcomes_under_control</span>,</span>
<span>         yhat1 <span class="op">=</span> <span class="va">potential_outcomes_under_treatment</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="step-3-estimate-the-causal-effect" class="section level2 unnumbered">
<h2>Step 3: Estimate the causal effect<a class="anchor" aria-label="anchor" href="#step-3-estimate-the-causal-effect"><i class="fas fa-link"></i></a>
</h2>
<p>Now let’s compute the causal effect by taking the difference between their potential outcomes and averaging.</p>
<p>One way to do this is:</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">conditional_average_effects</span> <span class="op">&lt;-</span> <span class="va">conditional_average_outcomes</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>effect <span class="op">=</span> <span class="va">yhat1</span> <span class="op">-</span> <span class="va">yhat0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">conditional_average_effects</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">yhat1</span>, <span class="va">yhat0</span>, <span class="va">effect</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">summarise_all</a></span><span class="op">(</span>.funs <span class="op">=</span> <span class="va">mean</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   yhat1 yhat0 effect
##   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
## 1 0.404 0.163  0.241</code></pre>
<p>An alternative way to compute the treatment effect is below</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">conditional_average_outcomes</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>ate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">yhat1</span> <span class="op">-</span> <span class="va">yhat0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##     ate
##   &lt;dbl&gt;
## 1 0.241</code></pre>
</div>
<div id="extension-1-conditional-average-effects" class="section level2 unnumbered">
<h2>Extension 1: Conditional average effects<a class="anchor" aria-label="anchor" href="#extension-1-conditional-average-effects"><i class="fas fa-link"></i></a>
</h2>
<p>Modify the procedure above to estimate the average effect in subgroups defined by mom’s education:</p>
<ol style="list-style-type: decimal">
<li>those with <code>sex == Male</code>
</li>
<li>those with <code>sex == Female</code>
</li>
</ol>
<p>Specifically this means, what is the average effect among those for whom <code>sex == Male</code>?
Among those for whom <code>sex == Female</code>? <strong>HINT</strong>: this should only be a slight modification
of your code above that takes the average for the whole data.frame.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">conditional_average_effects</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">yhat1</span>, <span class="va">yhat0</span>, <span class="va">effect</span>, <span class="va">sex</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span>.fns <span class="op">=</span> <span class="va">mean</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Warning: There was 1 warning in `summarise()`.
## ℹ In argument: `across(.fns = mean)`.
## Caused by warning:
## ! Using `across()` without supplying `.cols` was deprecated
##   in dplyr 1.1.0.
## ℹ Please supply `.cols` instead.</code></pre>
<pre><code>## # A tibble: 2 × 4
##   sex    yhat1 yhat0 effect
##   &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
## 1 Female 0.348 0.129  0.219
## 2 Male   0.460 0.196  0.263</code></pre>
</div>
<div id="extension-2-logistic-regression" class="section level2 unnumbered">
<h2>Extension 2: Logistic regression<a class="anchor" aria-label="anchor" href="#extension-2-logistic-regression"><i class="fas fa-link"></i></a>
</h2>
<p>In groups: Repeat the steps above with logistic regression</p>
<p><span class="math display">\[\text{log}\left(\frac{\hat{P}\left(Y\mid A = a, \vec{L} = \vec\ell\right)}{1 - \hat{P}\left(Y\mid A = a, \vec{L} = \vec\ell\right)}\right) = \hat\alpha + A\hat\beta + \vec{L}'\hat{\vec\gamma} + A\vec{L}'\hat{\vec\eta}\]</span> Helpful hints:</p>
<ul>
<li>This should be a simple extension of all the code above that uses <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code>.</li>
<li>Read about using <code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code> to estimate logistic regression</li>
<li>when using <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code>, search to find out how to predict probabilities</li>
</ul>
</div>
<div id="extension-logistic-regression" class="section level2 unnumbered">
<h2>Extension: Logistic regression<a class="anchor" aria-label="anchor" href="#extension-logistic-regression"><i class="fas fa-link"></i></a>
</h2>
<p>Fit a model</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="va">y</span> <span class="op">~</span> <span class="va">a</span><span class="op">*</span><span class="op">(</span><span class="va">sex</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">mom_educ</span> <span class="op">+</span> <span class="va">dad_educ</span> <span class="op">+</span> <span class="va">log_parent_income</span> <span class="op">+</span></span>
<span>  <span class="va">log_parent_wealth</span> <span class="op">+</span> <span class="va">test_percentile</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">f</span>, family <span class="op">=</span> <span class="va">binomial</span>, data <span class="op">=</span> <span class="va">d</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="extension-logistic-regression-1" class="section level2 unnumbered">
<h2>Extension: Logistic regression<a class="anchor" aria-label="anchor" href="#extension-logistic-regression-1"><i class="fas fa-link"></i></a>
</h2>
<p>Predict and summarize to estimate the average effect</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">potential_outcomes_under_control</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">fit</span>, newdata <span class="op">=</span> <span class="va">d_all_control</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">potential_outcomes_under_treatment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">fit</span>, newdata <span class="op">=</span> <span class="va">d_all_treated</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">conditional_average_outcomes</span> <span class="op">&lt;-</span> <span class="va">d</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>yhat1 <span class="op">=</span> <span class="va">potential_outcomes_under_treatment</span>,</span>
<span>         yhat0 <span class="op">=</span> <span class="va">potential_outcomes_under_control</span>,</span>
<span>         effect <span class="op">=</span> <span class="va">yhat1</span> <span class="op">-</span> <span class="va">yhat0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">yhat1</span>, <span class="va">yhat0</span>, <span class="va">effect</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span>.fns <span class="op">=</span> <span class="va">mean</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">conditional_average_outcomes</span></span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   yhat1 yhat0 effect
##   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
## 1 0.406 0.165  0.241</code></pre>

</div>
</div>



  <div class="chapter-nav">
<div class="prev"><a href="solutions-matching-lab.html">Solutions: Matching Lab</a></div>
<div class="next"><a href="due-dates.html">Due dates</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#solutions-parametric-g-formula-lab">Solutions: Parametric g-formula Lab</a></li>
<li><a class="nav-link" href="#download-the-data">Download the Data</a></li>
<li><a class="nav-link" href="#step-0-learn-a-model-to-predict-y-given-avecl">Step 0: Learn a model to predict \(Y\) given \(\{A,\vec{L}\}\)</a></li>
<li><a class="nav-link" href="#step-1-create-two-copies-of-the-original-data">Step 1: Create Two Copies of the Original Data</a></li>
<li><a class="nav-link" href="#step-2-predict-both-potential-outcomes-for-everyone">Step 2: Predict both potential outcomes for everyone</a></li>
<li><a class="nav-link" href="#step-3-estimate-the-causal-effect">Step 3: Estimate the causal effect</a></li>
<li><a class="nav-link" href="#extension-1-conditional-average-effects">Extension 1: Conditional average effects</a></li>
<li><a class="nav-link" href="#extension-2-logistic-regression">Extension 2: Logistic regression</a></li>
<li><a class="nav-link" href="#extension-logistic-regression">Extension: Logistic regression</a></li>
<li><a class="nav-link" href="#extension-logistic-regression-1">Extension: Logistic regression</a></li>
</ul>
      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="syllabus" href="assets/Syllabus_Causal_Inference_3900.pdf">Syllabus </a></li>
          <li><a id="canvas" href="https://canvas.cornell.edu/courses/68745">Canvas </a></li>
          <li><a id="ed" href="https://edstem.org/us/courses/62970">Ed Discussion </a></li>
          
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>Last built on 2024-10-22</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This site was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
